<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniChancnel Cloud Integration Specification v2.48</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <h1>OmniChancnel Cloud Integration Specification v2.48</h1>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('request')">Request</button>
            <button class="tab-btn" onclick="switchTab('response')">Response</button>
            <button class="tab-btn" onclick="switchTab('validation')">Validation</button>
            <button class="tab-btn" onclick="switchTab('sslSocket')">SSL Socket Header</button>
        </div>
        
        <!-- Modal for Data Type Details -->
        <div class="modal-overlay" id="dataTypeModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modalTitle">Data Type Details</div>
                    <button class="modal-close" onclick="closeModal()">×</button>
                </div>
                <div class="modal-body" id="modalBody"></div>
            </div>
        </div>
        
        <!-- Tab Content: Request -->
        <div class="tab-content active" id="requestTab">
            <!-- Controls Panel -->
            <div class="controls">
                <div class="controls-grid">
                    <div class="control-group">
                        <label for="amount">Amount:</label>
                        <input type="number" id="amount" value="100.00" step="0.01" min="0">
                    </div>
                    
                    <div class="control-group">
                        <label for="transactionType">Transaction Type:</label>
                        <select id="transactionType" onchange="handleTransactionTypeChange()">
                            <option value="Sale">SALE</option>
                            <option value="MOTO">MOTO</option>
                            <option value="Crypto">CRYPTO</option>
                            <option value="Refund">REFUND</option>
                            <option value="Void">VOID</option>
                            <option value="TipAdjustment">TIP-ADJUSTMENT</option>
                            <option value="PreAuth">PRE-AUTH</option>
                            <option value="IncrementalAuth">INCREMENTAL-AUTH</option>
                            <option value="PreAuthCompletion">PRE-AUTH COMPLETION</option>
                            <option value="Settle">SETTLE</option>
                            <option value="Report">REPORT</option>
                            <option value="SessionManagement">SESSION-MANAGEMENT</option>
                            <option value="Signature">SIGNATURE</option>
                        </select>
                    </div>
                    
                    <div class="control-group" data-field="gratuity" style="display: none;">
                        <label for="gratuity">Gratuity (Tip):</label>
                        <input type="number" id="gratuity" value="0.00" step="0.01" min="0">
                    </div>
                    
                    <div class="control-group" data-field="reportType" style="display: none;">
                        <label for="reportType">Report Type:</label>
                        <select id="reportType">
                            <option value="HSTS">Host Totals Summary</option>
                            <option value="TMDR">Terminal Details Report</option>
                            <option value="TMSH">Terminal Sales By Hour</option>
                            <option value="TMTS">Terminal Totals Summary</option>
                            <option value="TRRP">Transaction Receipt Reprint</option>
                            <option value="TMCD" selected>Terminal Configuration Detail</option>
                            <option value="PARD">PreAuth Details Report</option>
                        </select>
                    </div>
                    
                    <div class="control-group" data-field="sessionType" style="display: none;">
                        <label for="sessionType">Session Component:</label>
                        <select id="sessionType">
                            <option value="POI">POI Component (Terminal Side)</option>
                            <option value="POS">POS Component (Register Side)</option>
                        </select>
                    </div>
                    
                    <div class="control-group" data-field="exchangeAction" style="display: none;">
                        <label for="exchangeAction">Exchange Action:</label>
                        <select id="exchangeAction" onchange="handleExchangeActionChange()">
                            <option value="INIT">INIT - Initialize</option>
                            <option value="NOTI">NOTI - Notification</option>
                            <option value="RETR">RETR - Retrieve transaction</option>
                            <option value="RECV">RECV - Recover session</option>
                            <option value="CANC">CANC - Cancel transaction</option>
                        </select>
                    </div>
                    
                    <div class="control-group" data-field="exchangeIdentification" style="display: none;">
                        <label for="exchangeIdentification">Exchange Identification:</label>
                        <input type="text" id="exchangeIdentification" placeholder="UUID for RETR/RECV/CANC">
                    </div>
                    
                   
                    
                    <div class="control-group" data-field="deviceState" style="display: none;">
                        <label for="deviceState">Device State:</label>
                        <select id="deviceState">
                            <option value="">None</option>
                            <option value="BUSY">Busy</option>
                            <option value="IDLE">Idle</option>
                            <option value="UNAV">Unavailable</option>
                            <option value="OFFL">Offline</option>
                        </select>
                    </div>
                    
                    <div class="control-group" data-field="originalTransactionId" style="display: none;">
                        <label for="originalTransactionId">Original Transaction ID:</label>
                        <input type="text" id="originalTransactionId" placeholder="Transaction ID to void">
                    </div>
                    
                    <div class="control-group">
                        <label for="clerkId">Clerk ID:</label>
                        <input type="text" id="clerkId" placeholder="Clerk ID">
                    </div>
                    
                    <div class="control-group">
                        <label for="invoiceNumber">Invoice Number:</label>
                        <input type="text" id="invoiceNumber" placeholder="Invoice Number">
                    </div>
                    
                    <div class="control-group">
                        <label for="idType">ID Type:</label>
                        <input type="text" id="idType" placeholder="ID Type">
                    </div>
                    
                    <div class="control-group">
                        <label for="industryData">Industry Data:</label>
                        <select id="industryData">
                            <option value="none">None</option>
                            <option value="vehicle">Vehicle Rental</option>
                            <option value="lodging">Lodging</option>
                            <option value="travel">Travel & Cruise</option>
                        </select>
                    </div>
                </div>
                <button onclick="generateJSON()">Generate JSON</button>
                <div id="validationStatus"></div>
            </div>
            
            <!-- Main Grid -->
            <div class="demo-grid">
                <div class="panel">
                    <div class="panel-header">Message Structure (Click for details)</div>
                    <div class="panel-content">
                        <div class="spec-tree" id="specTree"></div>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-header">Data Types Reference</div>
                    <div class="panel-content">
                        <div class="data-types" id="dataTypes"></div>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-header">Generated JSON</div>
                    <div class="panel-content">
                        <button class="copy-btn-top" onclick="copyJSON()">Copy JSON</button>
                        <div class="json-output" id="jsonOutput">Click "Generate JSON"...</div>
                    </div>
                </div>
            </div>
            
            <!-- Basic Data Types Section -->
            <div class="panel" style="margin-top: 20px;">
                <div class="panel-header">Basic Data Types Reference</div>
                <div class="panel-content">
                    <div class="basic-types" id="basicTypes"></div>
                </div>
            </div>
        </div>
        
        <!-- Tab Content: Response -->
        <div class="tab-content" id="responseTab">
            <!-- Response Controls Panel -->
            <div class="controls">
                <div class="controls-grid">
                    <div class="control-group">
                        <label for="responseTransactionType">Transaction Type:</label>
                        <select id="responseTransactionType" onchange="handleResponseTransactionTypeChange()">
                            <option value="Sale">SALE</option>
                            <option value="MOTO">MOTO</option>
                            <option value="Crypto">CRYPTO</option>
                            <option value="Refund">REFUND</option>
                            <option value="Void">VOID</option>
                            <option value="TipAdjustment">TIP-ADJUSTMENT</option>
                            <option value="PreAuth">PRE-AUTH</option>
                            <option value="IncrementalAuth">INCREMENTAL-AUTH</option>
                            <option value="PreAuthCompletion">PRE-AUTH COMPLETION</option>
                            <option value="Settle">SETTLE</option>
                            <option value="Report">REPORT</option>
                            <option value="SessionManagement">SESSION-MANAGEMENT</option>
                            <option value="Signature">SIGNATURE</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="responseAmount">Amount:</label>
                        <input type="number" id="responseAmount" value="100.00" step="0.01" min="0">
                    </div>
                    
                    <div class="control-group">
                        <label for="responseGratuity">Gratuity (Tip):</label>
                        <input type="number" id="responseGratuity" value="0.00" step="0.01" min="0">
                    </div>
                    
                    <div class="control-group" data-field="responseReportType" style="display: none;">
                        <label for="responseReportType">Report Type:</label>
                        <select id="responseReportType">
                            <option value="HSTS">Host Totals Summary</option>
                            <option value="TMDR">Terminal Details Report</option>
                            <option value="TMSH">Terminal Sales By Hour</option>
                            <option value="TMTS">Terminal Totals Summary</option>
                            <option value="TRRP">Transaction Receipt Reprint</option>
                            <option value="TMCD">Terminal Configuration Detail</option>
                            <option value="PARD">PreAuth Details Report</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-top: 26px;">
                            <input type="checkbox" id="verbatimReceipt" style="width: auto;">
                            <span>Verbatim Receipt</span>
                        </label>
                    </div>
                    
                    <div class="control-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-top: 26px;">
                            <input type="checkbox" id="tokenResponse" style="width: auto;">
                            <span>Token Response</span>
                        </label>
                    </div>
                </div>
                <button onclick="generateResponseJSON()">Generate Response JSON</button>
            </div>
            
            <!-- Response Grid -->
            <div class="demo-grid">
                <div class="panel">
                    <div class="panel-header">Response Message Structure</div>
                    <div class="panel-content">
                        <div class="spec-tree" id="responseSpecTree"></div>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-header">Data Types Reference</div>
                    <div class="panel-content">
                        <div class="data-types" id="responseDataTypes"></div>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-header">Generated Response JSON</div>
                    <div class="panel-content">
                        <button class="copy-btn-top" onclick="copyResponse()">Copy Response</button>
                        <div class="json-output" id="responseOutput">Click "Generate Response JSON"...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab Content: Validation -->
        <div class="tab-content" id="validationTab">
            <div class="panel">
                <div class="panel-header">Validate JSON Payload</div>
                <div class="panel-content">
                    <div style="margin-bottom: 15px;">
                        <label for="validationInput" style="display: block; margin-bottom: 8px; font-weight: 600;">JSON Payload:</label>
                        <textarea
                            id="validationInput"
                            class="json-input"
                            rows="15"
                            placeholder='Paste your JSON payload here, or generate one from the Request tab...

Example:
{
  "OCserviceRequest": {
    "header": { ... },
    "serviceRequest": { ... }
  }
}'
                        ></textarea>
                    </div>
                    <button onclick="validatePayload()" style="width: auto; margin-top: 0;">Validate Payload</button>

                    <div id="validationResults" style="margin-top: 20px;">
                        <p style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border-radius: 6px;">
                            <strong>No validation performed yet.</strong><br><br>
                            You can either:<br>
                            • Generate a JSON from the <strong>Request</strong> tab (auto-populates here)<br>
                            • Paste your own JSON payload above<br><br>
                            Then click <strong>"Validate Payload"</strong> to check for errors.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: SSL Socket Header -->
        <div class="tab-content" id="sslSocketTab">
            <div class="panel">
                <div class="panel-header">2.2.1 Overview</div>
                <div class="panel-content">
                    <div class="ssl-socket-content">
                        <p>A message consists of 2 parts:</p>
                        <ul>
                            <li><strong>Session header</strong> (Not used in RESTful server)</li>
                            <li><strong>Application data</strong></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="panel" style="margin-top: 20px;">
                <div class="panel-header">2.2.2 Session Header</div>
                <div class="panel-content">
                    <div class="ssl-socket-content">
                        <p>The session header has a fixed length of <strong>16 bytes</strong> and consists of the following fields:</p>

                        <table class="ssl-header-table">
                            <thead>
                                <tr>
                                    <th>Element</th>
                                    <th>Format</th>
                                    <th>Length</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>messageLength</code></td>
                                    <td>binary</td>
                                    <td>4</td>
                                    <td>
                                        The length counts all subsequent bytes starting from the field up to the last byte of the message data (so excluding)<br>
                                        <strong>Big-endian byte order (network order)</strong>
                                    </td>
                                </tr>
                                <tr>
                                    <td><code>headerVersion</code></td>
                                    <td>hex</td>
                                    <td>2</td>
                                    <td>
                                        Version number of header.<br>
                                        Format (in hex): <strong>MMmm</strong> where MM is the major version and mm the minor version<br>
                                        Current version: <strong>'0100'</strong>
                                    </td>
                                </tr>
                                <tr>
                                    <td><code>protocolVersion</code></td>
                                    <td>hex</td>
                                    <td>2</td>
                                    <td>
                                        Version number of the protocol specification used during your integration development.<br>
                                        Format (in hex): <strong>MMmm</strong> where MM is the major version and mm the minor version.<br>
                                        Current version: <strong>'0248'</strong> (for protocol version 2.48)
                                    </td>
                                </tr>
                                <tr>
                                    <td><code>messageIdentification</code></td>
                                    <td>binary</td>
                                    <td>8</td>
                                    <td>
                                        Exchange identification<br>
                                        <strong>Big-endian byte order (network order)</strong>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="panel" style="margin-top: 20px;">
                <div class="panel-header">2.2.3 Message Identification</div>
                <div class="panel-content">
                    <div class="ssl-socket-content">
                        <p>Each session header contains an element. This is used to allow a sender of a primary message to match an incoming secondary message to a previously sent primary message.</p>

                        <p><strong>The following rules apply for the element:</strong></p>
                        <ul>
                            <li>A sender of a primary message may choose any value but must change the value from one message to the next. There is no requirement to use consecutive values. A simple way, however might be an increment of a counter for every new primary message.</li>
                            <li>A sender of a response message must use the same value as received in the request message.</li>
                            <li>The value must be unique for a period long enough to exclude misinterpretation.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="panel" style="margin-top: 20px;">
                <div class="panel-header">2.2.4 Example: SSL Socket Message Structure</div>
                <div class="panel-content">
                    <div class="ssl-socket-content">
                        <p>Below is an example showing how a complete message is constructed with the SSL socket header followed by the JSON payload:</p>

                        <div class="ssl-example-section">
                            <div class="ssl-example-header">
                                <h4>Session Header (16 bytes)</h4>
                                <div class="ssl-header-breakdown">
                                    <div class="ssl-header-field">
                                        <span class="field-label">messageLength:</span>
                                        <code class="field-value">0x00000428</code>
                                        <span class="field-note">(1064 bytes - length of JSON payload)</span>
                                    </div>
                                    <div class="ssl-header-field">
                                        <span class="field-label">headerVersion:</span>
                                        <code class="field-value">0x0100</code>
                                        <span class="field-note">(version 1.0)</span>
                                    </div>
                                    <div class="ssl-header-field">
                                        <span class="field-label">protocolVersion:</span>
                                        <code class="field-value">0x0248</code>
                                        <span class="field-note">(protocol version 2.48)</span>
                                    </div>
                                    <div class="ssl-header-field">
                                        <span class="field-label">messageIdentification:</span>
                                        <code class="field-value">0x0000000000000001</code>
                                        <span class="field-note">(message ID: 1)</span>
                                    </div>
                                </div>
                            </div>

                            <div class="ssl-example-payload">
                                <h4>Application Data (JSON Payload)</h4>
                                <div class="json-example-output">
<pre>{
  "OCserviceRequest": {
    "header": {
      "messageFunction": "AUTQ",
      "protocolVersion": "2.0",
      "exchangeIdentification": "a3ae9a69-fe36-4d65-accd-5ea19ea97716",
      "creationDateTime": "2025-10-31T20:12:56.738Z",
      "initiatingParty": {
        "identification": "20000004",
        "type": "PID",
        "shortName": "Cash Register ID",
        "authenticationKey": "2E3559C5-2021-4F45-A615-A6C00951C7D5"
      },
      "recipientParty": {
        "identification": "11000499",
        "type": "TID",
        "shortName": "Terminal  ID"
      }
    },
    "serviceRequest": {
      "environment": {
        "merchant": {
          "identification": "7800199838"
        },
        "POI": {
          "identification": "11000499"
        }
      },
      "context": {
        "saleContext": {
          "saleIdentification": "",
          "saleReferenceNumber": "",
          "SaleReconciliationIdentification": ""
        }
      },
      "serviceContent": "FSPQ",
      "paymentRequest": {
        "transactionType": "CRDP",
        "transactionDetails": {
          "totalAmount": "100.00",
          "MOTOIndicator": false,
          "detailedAmount": {
            "amountGoodsAndServices": "100.00"
          }
        }
      }
    }
  }
}</pre>
                                </div>
                            </div>

                            <div class="ssl-example-notes">
                                <h4>Important Notes:</h4>
                                <ul>
                                    <li><strong>Binary Transmission:</strong> The session header is sent as binary data (16 bytes) in big-endian byte order (network order).</li>
                                    <li><strong>Message Length Calculation:</strong> The messageLength field contains the byte count of the JSON payload only (excluding the header itself).</li>
                                    <li><strong>Sequential Flow:</strong> The 16-byte header is sent first, immediately followed by the JSON application data.</li>
                                    <li><strong>Exchange ID Matching:</strong> The messageIdentification in the binary header (0x0000000000000001) is used to match responses to requests, separate from the exchangeIdentification in the JSON payload.</li>
                                    <li><strong>RESTful vs SSL Socket:</strong> When using RESTful APIs, the session header is NOT used - only the JSON payload is transmitted via HTTP/HTTPS.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Load JavaScript modules -->
    <script type="module" src="js/data.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>